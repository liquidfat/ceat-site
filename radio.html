<!DOCTYPE html>
<html lang="en">
    
<head>
    <title>ceat</title>
    <link href="css/style.css" rel="stylesheet" type="text/css">
  
    <meta charset="UTF-8">
    <meta name="description" content="Your description">
    <meta name="keywords" content="Your keywords">
    <meta name="author" content="Christopher Keatinge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
    
<body>
    
  <header class="header">
    <h1>ceat.fun</h1>

    <!-- Hamburger button -->
    <button class="hamburger" onclick="toggleMenu()">
      â˜°
    </button>

    <script>
      function toggleMenu() {
      const nav = document.getElementById('navMenu');
      nav.classList.toggle('active');
      }
      
      
    async function checkStreamStatus() {
    const img = document.getElementById('radioGif');
    const statusUrl = 'https://sapircast.caster.fm:12993/admin/publicstats.json';

    try {
      const response = await fetch(statusUrl);
      if (!response.ok) throw new Error('Network response not OK');

      const stats = await response.json();
      const sourceKey = Object.keys(stats[1].source)[0];
      const sourceData = stats[1].source[sourceKey];

      // If there are >0 listeners OR a streaming start time, consider it live
      if (sourceData.listeners > 0 || sourceData.stream_start_iso8601) {
        img.src = 'images/gifs/radio.gif';   // Live GIF
      } else {
        img.src = 'images/archive/radio-offline.jpg'; // Offline img
      }
    } catch (err) {
      console.error('Stream status check failed:', err);
      img.src = 'images/archive/radio-offline.jpg'; // Default fallback
    }
  }

          // Initial check and periodic updates
          checkStreamStatus();
          setInterval(checkStreamStatus, 10000); // every 10 seconds

          async function updateNowPlaying() {
      try {
        // Step 1: Fetch current track from your Caster.fm JSON
        const statusUrl = "https://sapircast.caster.fm:12993/admin/publicstats.json"; 
        const response = await fetch(statusUrl);
        const data = await response.json();

        // Adjust depending on your JSON structure
        const sourceKey = Object.keys(data[1].source)[0];
        const currentSong = data[1].source[sourceKey].title || "Unknown Track";

        document.getElementById("trackInfo").textContent = currentSong;

        // Step 2: Search iTunes for album artwork
        const searchUrl = "https://itunes.apple.com/search?term=" + encodeURIComponent(currentSong) + "&entity=song&limit=1";
        const itunesResponse = await fetch(searchUrl);
        const itunesData = await itunesResponse.json();

        if (itunesData.results.length > 0) {
          const artwork = itunesData.results[0].artworkUrl100.replace("100x100", "300x300");
          document.getElementById("albumArt").src = artwork;
        } else {
          document.getElementById("albumArt").src = "images/archive/ancient.jpg"; // fallback
        }

      } catch (err) {
        console.error("Now Playing update failed:", err);
        document.getElementById("trackInfo").textContent = "Offline / No track info";
        document.getElementById("albumArt").src = "images/archive/ancient.jpg";
      }
    }

    // Initial fetch and periodic updates
    updateNowPlaying();
    setInterval(updateNowPlaying, 5000); // every 20 seconds
      
    </script>  
    
    <!-- Navigation links -->
    <ul class="nav" id="navMenu">
      <li><a href="index.html">index</a></li>
      <li><a href="gallery.html">gallery</a></li>
      <li><a href="radio.html" style="color: #ff0077;">radio</a></li>
      <li><a href="contact.html">contact</a></li>
    </ul>
  </header>
    
  
  <div class="row">
  
    <div class="col2">
    <div class="chat">
        <script id="cid0020000415294015084" data-cfasync="false" async src="//st.chatango.com/js/gz/emb.js">{"handle":"ceatfun","arch":"js","styles":{"a":"ff0077","b":100,"c":"000000","d":"000000","k":"ff0077","l":"ff0077","m":"ff0077","p":"10","q":"ff0077","r":100,"t":0,"usricon":0,"surl":0}}</script>
    </div>
    </div>
    
    <div class="col2">
      <div class="radio">
        <div data-type="newStreamPlayer" data-publicToken="e3056f6f-039e-438c-b24c-a9bdcf5f9bbc" data-theme="dark" data-color="0016FF" data-channelId="" data-rendered="false" class="cstrEmbed"><a href="https://www.caster.fm">Shoutcast Hosting</a> <a href="https://www.caster.fm">Stream Hosting</a> <a href="https://www.caster.fm">Radio Server Hosting</a></div><script src="//cdn.cloud.caster.fm//widgets/embed.js"></script>
        <img id="radioGif" class="radiogif" src="images/archive/radio-offline.jpg" alt="Radio status">
      </div>
      
    </div>
      
  </div>
  
  <div class="now-playing">
  <p id="trackInfo">Loading current track...</p>
  <img id="albumArt" src="images/archive/ancient.jpg" alt="Album Art" width="300">
</div>

>

</body>
    
</html>